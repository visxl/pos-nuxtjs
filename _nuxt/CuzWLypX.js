import{_ as te}from"./bgxFSIxJ.js";import{_ as oe,a as le,b as se,c as ae,d as ne,e as re}from"./Bc_9lAEa.js";import{m as ce,r as m,l as q,M as X,n as ie,j as de,p as ue,o as u,c as b,a as l,b as a,h as t,x as fe,C as pe,F as E,y as O,D as Y,g as F,w as n,d as i,t as c,z as me,a5 as _e,_ as be}from"./Cmpe_WKc.js";import{_ as ve}from"./DoUMQrUc.js";import"./BDck7c17.js";function ge(){const z=ce(),v=de(),x=m(""),_=m([]),d=m([]),y=m([]),w=m(!1),g=m(1),T=m(1),U=m(0),I=m(20),A=m(["All"]),C=m("All"),M=q(()=>d.value.length),N=q(()=>d.value.reduce((e,r)=>e+r.price*r.quantity,0)),S=q(()=>N.value*0),j=q(()=>N.value+S.value);X(async()=>{try{const r=await(await fetch(`${v.public.apiBaseUrl}/api/v1/category/categories`)).json();if(Array.isArray(r)){const f=r.map(p=>p.categoryName);A.value=["All",...f]}}catch(e){console.error("Failed to fetch categories:",e)}});async function $(e=1){w.value=!0,g.value=e;try{const f=C.value==="All"||!C.value?`${v.public.apiBaseUrl}/api/v1/product?pageNumber=${e}&pageSize=${I.value}`:`${v.public.apiBaseUrl}/api/v1/product/category?name=${encodeURIComponent(C.value)}&pageNumber=${e}&pageSize=${I.value}`,p=await fetch(f);if(!p.ok)throw new Error("Failed to load products");const P=await p.json();P&&(y.value=P.content||[],U.value=P.totalElements||y.value.length,T.value=P.totalPages||1)}catch(r){console.error("Error loading products:",r),y.value=[]}finally{w.value=!1}}async function D(e){C.value=e,await $(1)}const K=async()=>{if(!x.value.trim()){_.value=[];return}try{const r=await(await fetch(`${v.public.apiBaseUrl}/api/v1/product/find?text=${encodeURIComponent(x.value)}`)).json();_.value=Array.isArray(r)?r:[]}catch(e){console.error("Error searching products:",e),_.value=[]}};function H(e){const r=d.value.findIndex(f=>f.productId===e.productId);r>=0?d.value[r].quantity++:d.value.push({...e,quantity:1}),x.value="",_.value=[]}function J(e){d.value.splice(e,1)}function L(e){e.quantity=Math.max(1,e.quantity)}function B(){d.value=[]}async function Q(){localStorage.setItem("receipt",JSON.stringify(d.value)),z.push("/receipt")}async function G(){if(d.value.length!==0)try{const e=await fetch(`${v.public.apiBaseUrl}/api/v1/orderItem/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderItems:d.value.map(r=>({productCode:r.productCode,quantity:r.quantity}))})});if(!e.ok){const r=await e.text();throw new Error(r||"Failed to create order")}await e.json(),z.push("/receipt"),B()}catch(e){console.error("Error creating order:",e),alert("Failed to create order. Please try again.")}}function o(){g.value<T.value&&g.value++}function V(){g.value>1&&g.value--}function h(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}return ie(g,e=>{$(e)}),X(()=>{$()}),{searchText:x,searchResults:_,selectedProducts:d,products:y,loading:w,currentPage:g,totalPages:T,totalProducts:U,pageSize:I,categories:A,selectedCategory:C,item:M,subTotal:N,vatAmount:S,total:j,loadProducts:$,fetchByCategory:D,handleSearchEnter:K,selectProduct:H,removeProduct:J,updateTotal:L,cancelOrder:B,printReceipt:Q,createOrder:G,nextPage:o,prevPage:V,formatCurrency:h}}const ye={class:"flex h-[calc(100vh-64px)] overflow-hidden"},he={class:"flex-shrink-0 w-[600px] p-4 bg-white border-r flex flex-col"},xe={class:"relative flex flex-col gap-2"},we={key:0,class:"absolute z-50 w-full mt-1 overflow-y-auto bg-white border border-gray-200 rounded-md shadow-md top-full max-h-60"},Ce=["onClick"],ke={class:"font-semibold"},$e={class:"float-right"},Pe={class:"flex-1 mt-6 overflow-y-auto"},Te={class:"sticky bottom-0 pt-4 mt-auto bg-white border-t border-gray-200"},Ie={class:"grid grid-cols-4 gap-2 mb-4"},Ne={class:"font-bold"},Ue={class:"font-bold"},Ae={class:"font-bold"},Se={class:"font-bold"},je={class:"grid grid-cols-2 gap-2"},Be={class:"flex flex-col flex-1 overflow-hidden"},Ve={class:"flex items-center justify-between flex-shrink-0 px-4 py-2 border-b"},Re={class:"w-full overflow-x-auto no-scrollbar"},qe={class:"flex space-x-2 w-max"},Ee={class:"flex flex-col flex-1 overflow-hidden"},Oe={class:"flex-1 p-6 overflow-y-auto"},Fe={key:0,class:"flex items-center justify-center h-full"},ze={key:1,class:"flex items-center justify-center h-full"},Me={key:2,class:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5"},De={class:"text-sm font-medium text-center"},Ke={class:"text-xs font-bold"},He={class:"text-xs text-gray-600"},Je={class:"sticky bottom-0 flex h-12 mb-5"},Le={class:"flex items-center justify-center px-4 bg-gray-50"},Qe={class:"text-sm font-medium"},Ge=ue({__name:"pos",setup(z){const{searchText:v,searchResults:x,selectedProducts:_,products:d,loading:y,currentPage:w,totalPages:g,categories:T,selectedCategory:U,item:I,subTotal:A,vatAmount:C,total:M,fetchByCategory:N,handleSearchEnter:S,selectProduct:j,removeProduct:$,updateTotal:D,cancelOrder:K,printReceipt:H,createOrder:J,nextPage:L,prevPage:B,formatCurrency:Q}=ge();return(G,o)=>{const V=te,h=oe,e=le,r=se,f=re,p=me,P=ae,Z=ne,ee=ve,W=_e;return u(),b("div",ye,[l("aside",he,[l("div",xe,[a(V,{modelValue:t(v),"onUpdate:modelValue":o[0]||(o[0]=s=>fe(v)?v.value=s:null),type:"text",placeholder:"Search product...",class:"block w-full border border-blue-500 rounded-lg focus:border-blue-700 focus:ring-2 focus:ring-blue-200",onKeyup:pe(t(S),["enter"])},null,8,["modelValue","onKeyup"]),t(x).length?(u(),b("ul",we,[(u(!0),b(E,null,O(t(x),s=>(u(),b("li",{key:s.productId,onClick:k=>t(j)(s),class:"px-4 py-2 cursor-pointer hover:bg-gray-100"},[i(c(s.productName)+" - ",1),l("span",ke,c(s.productCode),1),l("span",$e,c(t(Q)(s.price)),1)],8,Ce))),128))])):Y("",!0)]),l("div",Pe,[t(_).length?(u(),F(Z,{key:0},{default:n(()=>[a(r,{class:"sticky top-0 text-blue-700 bg-white"},{default:n(()=>[a(e,{class:"font-semibold text-blue-700 border-b border-blue-200"},{default:n(()=>[a(h,null,{default:n(()=>o[1]||(o[1]=[i("No")])),_:1}),a(h,{class:"hidden"},{default:n(()=>o[2]||(o[2]=[i("Code")])),_:1}),a(h,null,{default:n(()=>o[3]||(o[3]=[i("Name")])),_:1}),a(h,null,{default:n(()=>o[4]||(o[4]=[i("Qty")])),_:1}),a(h,null,{default:n(()=>o[5]||(o[5]=[i("Price")])),_:1}),a(h,{class:"sr-only"},{default:n(()=>o[6]||(o[6]=[i("Action")])),_:1})]),_:1})]),_:1}),a(P,null,{default:n(()=>[(u(!0),b(E,null,O(t(_),(s,k)=>(u(),F(e,{key:`${s.productId}-${k}`,class:"transition duration-200 border-b border-blue-200 hover:border-blue-300"},{default:n(()=>[a(f,null,{default:n(()=>[i(c(k+1),1)]),_:2},1024),a(f,{class:"hidden"},{default:n(()=>[i(c(s.productCode),1)]),_:2},1024),a(f,null,{default:n(()=>[i(c(s.productName),1)]),_:2},1024),a(f,null,{default:n(()=>[a(V,{modelValue:s.quantity,"onUpdate:modelValue":R=>s.quantity=R,modelModifiers:{number:!0},type:"number",class:"w-auto border-blue-200 rounded-lg max-w-16",min:"1",onChange:R=>t(D)(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),a(f,null,{default:n(()=>[i(c(s.price*s.quantity+"៛"),1)]),_:2},1024),a(f,null,{default:n(()=>[a(p,{icon:"lucide:x",variant:"ghost",onClick:R=>t($)(k),class:"text-red-600 hover:bg-red-100"},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):Y("",!0)]),l("div",Te,[l("div",Ie,[o[7]||(o[7]=l("span",{class:"font-bold"},"Item:",-1)),l("div",Ne,c(t(I)),1),o[8]||(o[8]=l("span",{class:"mr-4 font-bold"},"VAT (10%):",-1)),l("div",Ue,c(t(C)+"៛"),1),o[9]||(o[9]=l("span",{class:"mr-4 font-bold"},"Sub Total:",-1)),l("div",Ae,c(t(A)+"៛"),1),o[10]||(o[10]=l("span",{class:"mr-4 font-bold"},"Total:",-1)),l("div",Se,c(t(M)+"៛"),1)]),l("div",je,[a(p,{color:"red",variant:"outline",onClick:t(K),class:"w-full"},{default:n(()=>o[11]||(o[11]=[i(" Cancel Order ")])),_:1},8,["onClick"]),a(p,{color:"green",onClick:t(J),class:"w-full row-span-2",disabled:t(_).length===0},{default:n(()=>o[12]||(o[12]=[i(" Payment ")])),_:1},8,["onClick","disabled"]),a(p,{color:"blue",onClick:t(H),class:"w-full",disabled:t(_).length===0},{default:n(()=>o[13]||(o[13]=[i(" Print Receipt ")])),_:1},8,["onClick","disabled"])])])]),l("div",Be,[l("header",Ve,[l("div",Re,[l("div",qe,[(u(!0),b(E,null,O(t(T),s=>(u(),F(p,{key:s,onClick:k=>t(N)(s),color:t(U)===s?"blue":"gray",variant:"ghost",class:"whitespace-nowrap"},{default:n(()=>[i(c(s),1)]),_:2},1032,["onClick","color"]))),128))])])]),l("main",Ee,[l("div",Oe,[t(y)?(u(),b("div",Fe)):t(d).length===0?(u(),b("div",ze,o[14]||(o[14]=[l("p",{class:"text-gray-500"},"No products found",-1)]))):(u(),b("div",Me,[(u(!0),b(E,null,O(t(d),(s,k)=>(u(),F(ee,{key:`${s.productId}-${k}`,class:"flex flex-col items-center justify-center w-full gap-2 transition-colors cursor-pointer h-44 hover:bg-gray-50",onClick:R=>t(j)(s)},{default:n(()=>[l("div",De,c(s.productName),1),l("div",Ke,c(s.price+"៛"),1),l("div",He,c(s.productCode),1)]),_:2},1032,["onClick"]))),128))]))]),l("div",Je,[a(p,{disabled:t(w)===1||t(y),onClick:t(B),class:"justify-center flex-1 py-4 text-blue-800 bg-blue-200 rounded-lg hover:bg-blue-100 disabled:bg-blue-100"},{default:n(()=>[a(W,{name:"i-heroicons-arrow-long-left",class:"w-6 h-6"})]),_:1},8,["disabled","onClick"]),l("div",Le,[l("span",Qe,c(t(w)),1)]),a(p,{disabled:t(w)===t(g)||t(y),onClick:t(L),class:"justify-center flex-1 py-4 text-blue-800 bg-blue-200 rounded-lg hover:bg-blue-100 disabled:bg-blue-100"},{default:n(()=>[a(W,{name:"i-heroicons-arrow-long-right",class:"w-6 h-6"})]),_:1},8,["disabled","onClick"])])])])])}}}),tt=be(Ge,[["__scopeId","data-v-1c61dc16"]]);export{tt as default};
